<?xml version="1.0" encoding="UTF-8"?>
<!-- Disclaimer: This questionnaire example is not derived from any medical questionnaire.  It contains unrelated questions and it is only created to show how the 
elements or extensions defined in the advanced form behavior profile are intended to be used. -->
<Questionnaire xmlns="http://hl7.org/fhir">
  <id value="questionnaire-sdc-profile-example-form-behavior"/>
  <!-- TODO: Temporarily disabled meta.profile since validation is failing with nested items.
  Exception in thread "main" org.hl7.fhir.exceptions.DefinitionException: Unable to resolve name reference http://hl7.org/fhir/StructureDefinition/Questionnaire#Questionnaire.item at path Questionnaire.item.item
  <meta>
    <profile value="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-behave"/>
  </meta>
  -->

  <!-- TODO: Temporarily disabled when 2.4 exception is resolved
  <contained>
    <ValueSet>
      <id value="vsConditionsFemale"/>
      <name value="ConditionsFemale"/>
      <title value="Female Conditions"/>
      <status value="active"/>
      <description value="The answer list for female-related conditions"/>
    </ValueSet>
  </contained>
  <contained>
    <ValueSet>
      <id value="vsConditionsAll"/>
      <url value="http://example.com/ValueSet/conditions-All"/>
      <name value="ConditionsAll"/>
      <title value="All Conditions"/>
      <status value="active"/>
      <description value="The answer list for all conditions"/>
    </ValueSet>
  </contained>
  -->

  <extension url="http://hl7.org/fhir/StructureDefinition/variable">
    <valueExpression>
      <name value="weight"/>
      <language value="text/fhirpath"/>
      <expression value="%resource.repeat(item).where(linkId='3.3.1').item.answer.valueDecimal"/>
    </valueExpression>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/variable">
    <valueExpression>
      <name value="height"/>
      <language value="text/fhirpath"/>
      <expression value="%resource.repeat(item).where(linkId='3.3.2').item.answer.valueDecimal*0.0254"/>
    </valueExpression>
  </extension>

  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-library">
    <valueCanonical value="http://example.com/Library/MeasurementLimits"/>
  </extension>
  <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-launchContext">
    <extension url="name">
      <valueCoding>
        <system value="http://hl7.org/fhir/uv/sdc/CodeSystem/launchContext"/>
        <code value="patient"/>
        <display value="Patient"/>
      </valueCoding>
    </extension>
    <extension url="type">
      <valueCode value="Patient"/>
    </extension>
    <extension url="description">
      <valueString value="The patient that is to be used to pre-populate the form"/>
    </extension>
  </extension>

  <!-- endpoint: Example o set an endpoint URL for the Form Receiver when the Questionnaire is completed.-->
  <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-endpoint">
    <valueUri value="http://mysite.app/QuestionnaireResponse/create"/>
  </extension>

  <!-- sequential: Example to display questions one at a time.-->
  <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-entryMode">
    <valueCode value="sequential"/>
  </extension>

  <url value="http://build.fhir.org/ig/HL7/sdc/questionnaire-sdc-profile-example-render"/>
  <name value="SDCAdvancedRenderingExample"/>
  <status value="draft"/>

  <item>
    <linkId value="1"/>
    <text value="Value constraints"/>
    <type value="group"/>

    <!-- maxLength: Example to restrict an answer to only have 50 characters.-->
    <item>
      <linkId value="1.1"/>
      <text value="First Name"/>
      <type value="string"/>
      <maxLength value="50"/>
    </item>

    <!-- minLength: Example to restrict an answer to have at least 2 characters.-->
    <item>
      <extension url="http://hl7.org/fhir/StructureDefinition/minLength">
        <valueInteger value="2"/>
      </extension>
      <linkId value="1.2"/>
      <text value="Last Name"/>
      <type value="string"/>
    </item>

    <!-- regex: Example to restrict an answer to be in this format: A1A 1A1-->
    <item>
      <extension url="http://hl7.org/fhir/StructureDefinition/regex">
        <valueString value="[A-Z][0-9][A-Z] [0-9][A-Z][0-9]" />
      </extension>
      <linkId value="1.3"/>
      <text value="Postal Code (A1A 1A1)"/>
      <type value="string"/>
    </item>

    <!-- minValue, maxValue, and maxDecimalPlaces: Example to restrict an answer to range from 1 to 100, up to 2 decimal places.-->
    <item>
      <extension url="http://hl7.org/fhir/StructureDefinition/minValue">
        <valueDecimal value="1"/>
      </extension>
      <extension url="http://hl7.org/fhir/StructureDefinition/maxValue">
        <valueDecimal value="100"/>
      </extension>
      <extension url="http://hl7.org/fhir/StructureDefinition/maxDecimalPlaces">
        <valueInteger value="2"/>
      </extension>
      <linkId value="1.4"/>
      <text value="Enter your weight in kg"/>
      <type value="decimal"/>
    </item>

    <!-- minQuantity and maxQuantity: Example to restrict the answer to range from 10 to 100 kilograms.-->
    <item>
      <extension url="http://hl7.org/fhir/StructureDefinition/questionnaire-unitValueSet">
        <valueCanonical value="http://hl7.org/fhir/ValueSet/ucum-bodyweight"/>
      </extension>
      <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-minQuantity">
        <valueQuantity>
          <value value="10"/>
          <system value="http://unitsofmeasure.org"/>
          <code value="kg"/>
        </valueQuantity>
      </extension>
      <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-maxQuantity">
        <valueQuantity>
          <value value="100"/>
          <system value="http://unitsofmeasure.org"/>
          <code value="kg"/>
        </valueQuantity>
      </extension>
      <linkId value="1.5"/>
      <text value="Body Weight"/>
      <type value="quantity"/>
    </item>

    <!-- mimeType and maxSize: Example to only allow a JPG or PDF attachment, up to 1,048,576 bytes.-->
    <item>
      <extension url="http://hl7.org/fhir/StructureDefinition/mimeType">
        <valueCode value="image/jpeg"/>
      </extension>
      <extension url="http://hl7.org/fhir/StructureDefinition/mimeType">
        <valueCode value="application/pdf"/>
      </extension>
      <extension url="http://hl7.org/fhir/StructureDefinition/maxSize">
        <valueDecimal value="1048576"/>
      </extension>
      <linkId value="1.6"/>
      <text value="Attach Proof of Citizenship"/>
      <type value="attachment"/>
    </item>
  </item>

  <item>
    <linkId value="2"/>
    <text value="Value constraints"/>
    <type value="group"/>

    <!-- answerOption: Example to restrict choices from a fixed list.-->
    <item>
      <linkId value="2.1"/>
      <text value="(I/We) worried whether (my/our) food would run out before (I/we) got money to buy more."/>
      <type value="choice"/>
      <answerOption>
        <valueCoding>
          <system value="http://loinc.org"/>
          <code value="LA28397-0"/>
          <display value="Often true"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <valueCoding>
          <system value="http://loinc.org"/>
          <code value="LA6729-3"/>
          <display value="Sometimes true"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <valueCoding>
          <system value="http://loinc.org"/>
          <code value="LA28398-8"/>
          <display value="Never true"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <valueCoding>
          <system value="http://loinc.org"/>
          <code value="LA15775-2"/>
          <display value="Don&#39;t know/refused"/>
        </valueCoding>
      </answerOption>
    </item>

    <!-- TODO: 2.2 example: answerOption and rendering-xhtml: Example to display answer options as images using the rendering-xhtml extension.-->

    <!-- answerValueSet: Example to restrict choices from a value set.-->
    <item>
      <linkId value="2.3"/>
      <text value="Activity Level"/>
      <type value="choice"/>
      <answerValueSet value="http://loinc.org/vs/LL4882-8"/>
    </item>

    <!-- answerValueSet with expressions: Example to restrict choices to distinct value sets based on context. -->
    <!-- TODO: temporary disabled since it causes NPE on QuestionnaireRender when answerValueSet does not have a value 
    <item>
      <linkId value="2.4"/>
      <text value="Applicable health conditions"/>
      <type value="choice"/>
      <repeats value="true"/>
      <answerValueSet>
        <extension url="http://hl7.org/fhir/StructureDefinition/cqf-expression">
          <valueExpression>
            <language value="text/fhirpath"/>
            <expression value="iif(%patient.gender='female','#vsConditionsFemale',iif(%patient.gender='male', '#vsConditionsFemale', '#vsConditionsAll'))">
              <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-referencesContained">
                <valueReference>
                  <reference value="#vsConditionsFemale"/>
                </valueReference>
              </extension>
              <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-referencesContained">
                <valueReference>
                  <reference value="#vsConditionsAll"/>
                </valueReference>
              </extension>
            </expression>
          </valueExpression>
        </extension>
      </answerValueSet>
    </item>
    -->

    <!-- answerOptionToggleExpression: Example to restrict control which choices are enabled based on context.-->
    <item>
      <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-answerOptionsToggleExpression">
        <extension url="option">
          <valueCoding>
            <system value="http://example.com/CodeSystem/conditions"/>
            <code value="3"/>
          </valueCoding>
        </extension>
        <extension url="expression">
          <valueExpression>
            <language value="text/fhirpath"/>
            <expression value="%patient.gender!='male'"/>
          </valueExpression>
        </extension>
      </extension>
      <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-answerOptionsToggleExpression">
        <extension url="option">
          <valueCoding>
            <system value="http://example.com/CodeSystem/conditions"/>
            <code value="4"/>
          </valueCoding>
        </extension>
        <extension url="expression">
          <valueExpression>
            <language value="text/fhirpath"/>
            <expression value="%patient.gender!='female'"/>
          </valueExpression>
        </extension>
      </extension>
      <linkId value="2.5"/>
      <text value="Applicable health conditions"/>
      <type value="choice"/>
      <repeats value="true"/>
      <answerValueSet value="#vsConditionsAll"/>
    </item>

    <!-- required: Example to equire an answer.-->
    <item>
      <linkId value="2.6"/>
      <text value="Email*"/>
      <type value="string"/>
      <required value="true"/>
    </item>

    <!-- readOnly: Example to only display a populated answer and make it non-editable.-->
    <item>
      <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression">
        <valueExpression>
          <description value="current date"/>
          <language value="text/fhirpath"/>
          <expression value="today()"/>
        </valueExpression>
      </extension>
      <linkId value="2.7"/>
      <text value="Current Date:"/>
      <type value="date"/>
      <readOnly value="true"/>
    </item>

    <!-- repeats and openLabel: Example to allow multiple answers, no limit and to specify label for alternate answer choices.-->
    <item>
      <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/questionnaire-sdc-openLabel">
        <valueString value="Other event (specify)"/>
      </extension>
      <linkId value="2.8"/>
      <text value="Heart History (check all that applies)"/>
      <type value="open-choice"/>
      <repeats value="true"/>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/procedures"/>
          <code value="U1"/>
          <display value="Heart attack"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/procedures"/>
          <code value="U2"/>
          <display value="Heart surgery"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/procedures"/>
          <code value="U3"/>
          <display value="Cardiac catheterization"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/procedures"/>
          <code value="U4"/>
          <display value="Coronary angioplasty (PTCA)"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/procedures"/>
          <code value="U5"/>
          <display value="Cardiac pacemaker"/>
        </valueCoding>
      </answerOption>
    </item>

    <!-- minOccurs: Example to require at least 2 answers-->
    <item>
      <extension url="http://hl7.org/fhir/StructureDefinition/questionnaire-minOccurs">
        <valueInteger value="2"/>
      </extension>
      <linkId value="2.9"/>
      <text value="Heart History (check at least 2):"/>
      <type value="choice"/>
      <required value="true"/>
      <repeats value="true"/>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/procedures"/>
          <code value="U1"/>
          <display value="Heart attack"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/procedures"/>
          <code value="U2"/>
          <display value="Heart surgery"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/procedures"/>
          <code value="U3"/>
          <display value="Cardiac catheterization"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/procedures"/>
          <code value="U4"/>
          <display value="Coronary angioplasty (PTCA)"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/procedures"/>
          <code value="U5"/>
          <display value="Cardiac pacemaker"/>
        </valueCoding>
      </answerOption>
    </item>

    <!-- maxOccurs: Example to limit up to 3 answers-->
    <item>
      <extension url="http://hl7.org/fhir/StructureDefinition/questionnaire-maxOccurs">
        <valueInteger value="3"/>
      </extension>
      <linkId value="2.10"/>
      <text value="Heart History (check no more than 3):"/>
      <type value="choice"/>
      <required value="true"/>
      <repeats value="true"/>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/procedures"/>
          <code value="U1"/>
          <display value="Heart attack"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/procedures"/>
          <code value="U2"/>
          <display value="Heart surgery"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/procedures"/>
          <code value="U3"/>
          <display value="Cardiac catheterization"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/procedures"/>
          <code value="U4"/>
          <display value="Coronary angioplasty (PTCA)"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/procedures"/>
          <code value="U5"/>
          <display value="Cardiac pacemaker"/>
        </valueCoding>
      </answerOption>
    </item>

    <!-- optionExclusive: Example to restrict other answers from being selected when an exclusive answer (like "None of the above") has been selected.-->
    <item>
      <extension url="http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl">
        <valueCodeableConcept>
          <coding>
            <system value="http://hl7.org/fhir/questionnaire-item-control"/>
            <code value="check-box"/>
            <display value="Check-box"/>
          </coding>
        </valueCodeableConcept>
      </extension>
      <linkId value="2.11"/>
      <text value="What treatments do you now have for heart disease? (select all that applies)"/>
      <type value="choice"/>
      <repeats value="true"/>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/treatments"/>
          <code value="noTreatment"/>
          <display value="NoTreatment"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/treatments"/>
          <code value="aspirin"/>
          <display value="Aspirin"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/treatments"/>
          <code value="otherMeds"/>
          <display value="Other medicines, tablets, or pills"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/treatments"/>
          <code value="diet"/>
          <display value="Diet"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <valueCoding>
          <system value="http://example.com/CodeSystem/treatments"/>
          <code value="exercise"/>
          <display value="Exercise"/>
        </valueCoding>
      </answerOption>
      <answerOption>
        <extension url="http://hl7.org/fhir/StructureDefinition/questionnaire-optionExclusive">
          <valueBoolean value="true"/>
        </extension>
        <valueCoding>
          <system value="http://example.com/CodeSystem/treatments"/>
          <code value="none"/>
          <display value="None of the above"/>
        </valueCoding>
      </answerOption>
    </item>

    <!-- unitOption: Example to restrict unit choices using unit option-->
    <item>
      <extension url="http://hl7.org/fhir/StructureDefinition/questionnaire-unitOption">
        <valueCoding>
          <system value="http://unitsofmeasure.org"/>
          <code value="mL"/>
          <display value="mL"/>
        </valueCoding>
      </extension>
      <extension url="http://hl7.org/fhir/StructureDefinition/questionnaire-unitOption">
        <valueCoding>
          <system value="http://unitsofmeasure.org"/>
          <code value="L"/>
          <display value="L"/>
        </valueCoding>
      </extension>
      <extension url="http://hl7.org/fhir/StructureDefinition/questionnaire-unitOption">
        <valueCoding>
          <system value="http://unitsofmeasure.org"/>
          <code value="g"/>
          <display value="g"/>
        </valueCoding>
      </extension>
      <extension url="http://hl7.org/fhir/StructureDefinition/questionnaire-unitOption">
        <valueCoding>
          <system value="http://unitsofmeasure.org"/>
          <code value="mg"/>
          <display value="mg"/>
        </valueCoding>
      </extension>
      <linkId value="2.12"/>
      <text value="Dosage"/>
      <type value="quantity"/>
    </item>

    <!-- unitValueSet: Example to restrict unit choices from a value set.-->
    <item>
      <extension url="http://hl7.org/fhir/StructureDefinition/questionnaire-unitValueSet">
        <valueCanonical value="http://hl7.org/fhir/ValueSet/age-units"/>
      </extension>
      <linkId value="2.13"/>
      <text value="Specify age:"/>
      <type value="quantity"/>
    </item>

    <!-- answerExpression, referenceResource, referenceProfile and lookupQuestionnaire: Example to restrict an answer to a specific resource or profile.-->
    <item>
      <extension url="http://hl7.org/fhir/StructureDefinition/questionnaire-referenceResource">
        <valueCode value="Practitioner"/>
      </extension>
      <extension url="http://hl7.org/fhir/StructureDefinition/questionnaire-referenceProfile">
        <valueCanonical value="http://hl7.org/fhir/us/core/StructureDefinition/us-core-practitioner"/>
      </extension>
      <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-lookupQuestionnaire">
        <valueUri value="http://mysite.com/Questionnaire/1234"/>
      </extension>
      <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-answerExpression">
        <valueExpression>
          <description value="all active practitioners"/>
          <language value="application/x-fhir-query"/>
          <expression value="Practitioner?active=true&amp;_sort=family,given"/>
        </valueExpression>
      </extension>
      <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-choiceColumn">
        <extension url="path">
          <valueString value="name.where(use='official').family + ', ' + name.where(use='official').given.first()"/>
        </extension>
        <extension url="forDisplay">
          <valueBoolean value="true"/>
        </extension>
      </extension>
      <linkId value="2.14"/>
      <text value="Select your preferred practitioner:"/>
      <type value="reference"/>
    </item>
  </item>

  <item>
    <linkId value="3"/>
    <text value="Calculation"/>
    <type value="group"/>

    <!-- initialExpression: Example with an initial expression. -->
    <item>
      <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression">
        <valueExpression>
          <description value="deadline for submission"/>
          <language value="text/fhirpath"/>
          <expression value="today() + 7 days"/>
        </valueExpression>
      </extension>
      <linkId value="3.1"/>
      <text value="Deadline for submission (7 days from now)"/>
      <type value="date"/>
      <readOnly value="true"/>
    </item>

    <!-- launchContext: Example to set resources that provide context for form processing logic.-->
    <item>
      <linkId value="3.2"/>
      <type value="group"/>
      <item>
        <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression">
          <valueExpression>
            <description value="patient's last name"/>
            <language value="text/fhirpath"/>
            <expression value="%patient.name.where(use='official').given.first()"/>
          </valueExpression>
        </extension>
        <linkId value="3.2.1"/>
        <text value="Last Name:"/>
        <type value="string"/>
        <readOnly value="true"/>
      </item>
      <item>
        <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression">
          <valueExpression>
            <description value="patient's first name"/>
            <language value="text/fhirpath"/>
            <expression value="%patient.name.where(use='official').family()"/>
          </valueExpression>
        </extension>
        <linkId value="3.2.2"/>
        <text value="First Name:"/>
        <type value="string"/>
        <readOnly value="true"/>
      </item>
      <item>
        <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression">
          <valueExpression>
            <description value="patient's gender"/>
            <language value="text/fhirpath"/>
            <expression value="%patient.gender"/>
          </valueExpression>
        </extension>
        <linkId value="3.2.3"/>
        <text value="Gender:"/>
        <type value="string"/>
        <readOnly value="true"/>
      </item>
    </item>

    <!-- calculatedExpression and variable: Example with a calculated expression -->
    <item>
      <linkId value="3.3"/>
      <text value="Calculated Expression"/>
      <type value="group"/>
      <item>
        <extension url="http://hl7.org/fhir/StructureDefinition/questionnaire-unit">
          <valueCoding>
            <system value="http://unitsofmeasure.org"/>
            <code value="kg"/>
          </valueCoding>
        </extension>
        <linkId value="3.3.1"/>
        <text value="Weight (kg)"/>
        <type value="decimal"/>
      </item>
      <item>
        <extension url="http://hl7.org/fhir/StructureDefinition/questionnaire-unit">
          <valueCoding>
            <system value="http://unitsofmeasure.org"/>
            <code value="[in_i]"/>
          </valueCoding>
        </extension>
        <linkId value="3.3.2"/>
        <text value="Body Height (inches)"/>
        <type value="decimal"/>
      </item>
      <item>
        <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-calculatedExpression">
          <valueExpression>
            <description value="BMI Calculation"/>
            <language value="text/fhirpath"/>
            <expression value="(%weight/(%height.power(2))).round(1)"/>
          </valueExpression>
        </extension>
        <linkId value="3.3.3"/>
        <text value="Your Body Mass Index (BMI) is"/>
        <type value="decimal"/>
        <readOnly value="true"/>
      </item>
    </item>

    <!-- cqf-calculatedValue, cqf-library and cqf-expression: Example question with a cqf-calculatedValue for minimum and maximum weight allowed and a question using a cqf-expression to determine if a question is required based on Patient data.-->
    <item>
      <linkId value="3.4"/>
      <text value="CQF-related Example"/>
      <type value="group"/>

      <item>
        <extension url="http://hl7.org/fhir/StructureDefinition/minValue">
          <valueDecimal value="1">
            <extension url="http://hl7.org/fhir/StructureDefinition/cqf-calculatedValue">
              <valueString value="min_weight"/>
            </extension>
          </valueDecimal>
        </extension>
        <extension url="http://hl7.org/fhir/StructureDefinition/maxValue">
          <valueDecimal value="100">
            <extension url="http://hl7.org/fhir/StructureDefinition/cqf-calculatedValue">
              <valueString value="max_weight"/>
            </extension>
          </valueDecimal>
        </extension>
        <linkId value="3.4.1"/>
        <text value="Enter weight in kg"/>
        <type value="decimal"/>
      </item>
      <item>
        <linkId value="3.4.2"/>
        <text value="Enter email address"/>
        <type value="string"/>
        <required value="false">
          <extension url="http://hl7.org/fhir/StructureDefinition/cqf-expression">
            <valueExpression>
              <description value="current date"/>
              <language value="text/fhirpath"/>
              <expression value="%patient.active"/>
            </valueExpression>
          </extension>
        </required>
      </item>
    </item>

    <!-- text and cqf-Expression: Text example with cqf-expression  -->
    <item>
      <linkId value="3.5"/>
      <text>
        <extension url="http://hl7.org/fhir/StructureDefinition/cqf-expression">
          <valueExpression>
            <description value="last immunization date"/>
            <language value="text/fhirpath"/>
            <expression value="'Your last immunization was on '+ %Immunization.occurrenceDateTime.substring(0,10) + '.'"/>
          </valueExpression>
        </extension>
      </text>
      <type value="display"/>
    </item>

  </item>

  <item>
    <linkId value="4"/>
    <text value="Other Controls"/>
    <type value="group"/>

    <!-- initial: Example of options with initial value.-->
    <item>
      <linkId value="4.1"/>
      <text value="Marital Status"/>
      <type value="choice"/>
      <answerValueSet value="http://hl7.org/fhir/ValueSet/marital-status"/>
      <initial>
        <valueCoding>
          <system value="http://terminology.hl7.org/CodeSystem/v3-MaritalStatus"/>
          <code value="D"/>
          <display value="Divorced"/>
        </valueCoding>
      </initial>
    </item>

    <!-- enableWhen, enableBehavior, and enableWhenExpression: Example of enabling behaviors.-->
    <item>
      <linkId value="4.2"/>
      <type value="group"/>
      <item>
        <linkId value="4.2.1"/>
        <text value="Choose Gender"/>
        <type value="choice"/>
        <answerValueSet value="http://hl7.org/fhir/ValueSet/administrative-gender"/>
      </item>
      <item>
        <linkId value="4.2.2"/>
        <text value="Are you pregnant? (enableWhen = gender is Female)"/>
        <type value="choice"/>
        <enableWhen>
          <question value="4.2.1"/>
          <operator value="="/>
          <answerCoding>
            <system value="http://hl7.org/fhir/administrative-gender"/>
            <code value="female"/>
          </answerCoding>
        </enableWhen>
        <answerValueSet value="http://hl7.org/fhir/ValueSet/yesnodontknow"/>
      </item>
      <item>
        <linkId value="4.2.3"/>
        <text value="Are you diabetic? (enableWhen = gender is Female)"/>
        <type value="choice"/>
        <enableWhen>
          <question value="4.2.1"/>
          <operator value="="/>
          <answerCoding>
            <system value="http://hl7.org/fhir/administrative-gender"/>
            <code value="female"/>
          </answerCoding>
        </enableWhen>
        <answerValueSet value="http://hl7.org/fhir/ValueSet/yesnodontknow"/>
      </item>
      <item>
        <linkId value="4.2.4"/>
        <text value="Have you been diagnosed with Gestational Diabetes? (enableBehavior = only when pregnant and diabetic)"/>
        <type value="choice"/>
        <enableWhen>
          <question value="4.2.2"/>
          <operator value="="/>
          <answerCoding>
            <system value="http://terminology.hl7.org/CodeSystem/v2-0136"/>
            <code value="Y"/>
          </answerCoding>
        </enableWhen>
        <enableWhen>
          <question value="4.2.3"/>
          <operator value="="/>
          <answerCoding>
            <system value="http://terminology.hl7.org/CodeSystem/v2-0136"/>
            <code value="Y"/>
          </answerCoding>
        </enableWhen>
        <enableBehavior value="all"/>
        <answerValueSet value="http://hl7.org/fhir/ValueSet/yesnodontknow"/>
      </item>
      <item>
        <extension url="http://hl7.org/fhir/StructureDefinition/entryFormat">
          <valueString value="MM/DD/YYYY"/>
        </extension>
        <linkId value="4.2.5"/>
        <text value="Enter your birthdate (MM/DD/YYYY)"/>
        <type value="date"/>
        <answerValueSet value="http://hl7.org/fhir/ValueSet/administrative-gender"/>
      </item>
      <item>
        <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression">
          <valueExpression>
            <description value="if last 2 questions were answered"/>
            <language value="text/fhirpath"/>
            <expression value="%resource.repeat(item).where(linkId='4.2.b.1').answer.value.code ='female' and today().toString().substring(0, 4).toInteger() - %resource.repeat(item).where(linkId='4.2.b.5').answer.value.toString().substring(0, 4).toInteger() >= 40"/>
          </valueExpression>
        </extension>
        <linkId value="4.2.6"/>
        <text value="Have you had mammogram before?(enableWhenExpression = only when gender is female and age > 40)"/>
        <type value="choice"/>
        <answerValueSet value="http://hl7.org/fhir/ValueSet/yesnodontknow"/>
      </item>
    </item>

    <!-- signatureRequired and usageMode: Example of a questionnaire requiring a signature.-->
    <item>
      <extension url="http://hl7.org/fhir/StructureDefinition/questionnaire-signatureRequired">
        <valueCodeableConcept>
          <coding>
            <system value="urn:iso-astm:E1762-95:2013"/>
            <code value="1.2.840.10065.1.12.1.8"/>
            <display value="Signature Witness Signature"/>
          </coding>
          <text value="the signature of a witness to any other signature."/>
        </valueCodeableConcept>
      </extension>
      <extension url="http://hl7.org/fhir/StructureDefinition/questionnaire-usageMode">
        <valueCode value="capture"/>
      </extension>
      <linkId value="4.4"/>
      <text value="Signature of Patient"/>
      <type value="attachment"/>
      <required value="true"/>
    </item>

    <!-- candidateExpression: Example to provide a list of candidate answers for the question item.-->
    <item>
      <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-candidateExpression">
        <valueExpression>
          <description value="active practitioners that speak at least one of the patient's language"/>
          <language value="application/x-fhir-query"/>
          <expression value="Practitioner?communication=&amp;active=true"/>
        </valueExpression>
      </extension>
      <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-choiceColumn">
        <extension url="path">
          <valueString value="name.first().family"/>
        </extension>
        <extension url="label">
          <valueString value="LAST NAME"/>
        </extension>
        <extension url="width">
          <valueQuantity>
            <value value="40"/>
            <system value="http://unitsofmeasure.org"/>
            <code value="%"/>
          </valueQuantity>
        </extension>
        <extension url="forDisplay">
          <valueBoolean value="true"/>
        </extension>
      </extension>
      <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-choiceColumn">
        <extension url="path">
          <valueString value="name.first().given.first()"/>
        </extension>
        <extension url="label">
          <valueString value="FIRST NAME"/>
        </extension>
        <extension url="width">
          <valueQuantity>
            <value value="40"/>
            <system value="http://unitsofmeasure.org"/>
            <code value="%"/>
          </valueQuantity>
        </extension>
        <extension url="forDisplay">
          <valueBoolean value="true"/>
        </extension>
      </extension>
      <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-choiceColumn">
        <extension url="path">
          <valueString value="gender"/>
        </extension>
        <extension url="label">
          <valueString value="GENDER"/>
        </extension>
        <extension url="width">
          <valueQuantity>
            <value value="20"/>
            <system value="http://unitsofmeasure.org"/>
            <code value="%"/>
          </valueQuantity>
        </extension>
        <extension url="forDisplay">
          <valueBoolean value="false"/>
        </extension>
      </extension>
      <linkId value="4.5"/>
      <text value="All the practitioners below can speak the patient's language. Choose all preferred practioners:"/>
      <type value="reference"/>
      <repeats value="true"/>
    </item>

    <!-- itemPopulationContext and itemExtractionContext: Example to specify the resources to populate and extract a questionnaire.-->
    <item>
      <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-itemPopulationContext">
        <valueExpression>
          <description value="Home address of the patient"/>
          <language value="text/fhirpath"/>
          <expression value="%patient.address.where(use='home')[0]"/>
        </valueExpression>
      </extension>
      <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-itemExtractionContext">
        <valueExpression>
          <description value="Home address of the patient"/>
          <language value="text/fhirpath"/>
          <expression value="%patient.address.where(use='home')[0]"/>
        </valueExpression>
      </extension>
      <linkId value="4.6"/>
      <type value="group"/>
      <item>
        <linkId value="4.6.1"/>
        <text value="Home Address"/>
        <type value="display"/>
      </item>
      <item>
        <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression">
          <valueExpression>
            <description value="Address Line 1"/>
            <language value="text/fhirpath"/>
            <expression value="line[0]"/>
          </valueExpression>
        </extension>
        <linkId value="4.6.2"/>
        <definition value="http://hl7.org/fhir/StructureDefinition/Patient#Patient.address.line"/>
        <text value="Address"/>
        <type value="string"/>
      </item>
      <item>
        <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression">
          <valueExpression>
            <description value="City"/>
            <language value="text/fhirpath"/>
            <expression value="city"/>
          </valueExpression>
        </extension>
        <linkId value="4.6.3"/>
        <definition value="http://hl7.org/fhir/StructureDefinition/Patient#Patient.address.city"/>
        <text value="City"/>
        <type value="string"/>
      </item>
      <item>
        <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression">
          <valueExpression>
            <description value="State"/>
            <language value="text/fhirpath"/>
            <expression value="state"/>
          </valueExpression>
        </extension>
        <linkId value="4.6.4"/>
        <definition value="http://hl7.org/fhir/StructureDefinition/Patient#Patient.address.state"/>
        <text value="Province"/>
        <type value="choice"/>
        <answerOption>
          <valueCoding>
            <system value="http://example.com/CodeSystem/provinces"/>
            <code value="Alberta"/>
            <display value="Alberta"/>
          </valueCoding>
        </answerOption>
        <answerOption>
          <valueCoding>
            <system value="http://example.com/CodeSystem/provinces"/>
            <code value="BritishColumbia"/>
            <display value="British Columbia"/>
          </valueCoding>
        </answerOption>
        <answerOption>
          <valueCoding>
            <system value="http://example.com/CodeSystem/provinces"/>
            <code value="Manitoba"/>
            <display value="Manitoba"/>
          </valueCoding>
        </answerOption>
        <answerOption>
          <valueCoding>
            <system value="http://example.com/CodeSystem/provinces"/>
            <code value="NewBrunswick"/>
            <display value="New Brunswick"/>
          </valueCoding>
        </answerOption>
        <answerOption>
          <valueCoding>
            <system value="http://example.com/CodeSystem/provinces"/>
            <code value="NewfoundlandAndLabrador"/>
            <display value="Newfoundland and Labrador"/>
          </valueCoding>
        </answerOption>
        <answerOption>
          <valueCoding>
            <system value="http://example.com/CodeSystem/provinces"/>
            <code value="NovaScotia"/>
            <display value="Nova Scotia"/>
          </valueCoding>
        </answerOption>
        <answerOption>
          <valueCoding>
            <system value="http://example.com/CodeSystem/provinces"/>
            <code value="Ontario"/>
            <display value="Ontario"/>
          </valueCoding>
        </answerOption>
        <answerOption>
          <valueCoding>
            <system value="http://example.com/CodeSystem/provinces"/>
            <code value="PrinceEdwardIsland"/>
            <display value="Prince Edward Island"/>
          </valueCoding>
        </answerOption>
        <answerOption>
          <valueCoding>
            <system value="http://example.com/CodeSystem/provinces"/>
            <code value="Quebec"/>
            <display value="Quebec"/>
          </valueCoding>
        </answerOption>
        <answerOption>
          <valueCoding>
            <system value="http://example.com/CodeSystem/provinces"/>
            <code value="Saskatchewan"/>
            <display value="Saskatchewan"/>
          </valueCoding>
        </answerOption>
      </item>
      <item>
        <extension url="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression">
          <valueExpression>
            <description value="Postal Code"/>
            <language value="text/fhirpath"/>
            <expression value="postalCode"/>
          </valueExpression>
        </extension>
        <linkId value="4.6.5"/>
        <definition value="http://hl7.org/fhir/StructureDefinition/Patient#Patient.address.postalCode"/>
        <text value="Postal Code"/>
        <type value="string"/>
      </item>
    </item>
  </item>
</Questionnaire>